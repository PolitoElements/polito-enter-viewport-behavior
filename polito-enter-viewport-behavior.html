<script>
    if (typeof(Polito) != "object") {
        var Polito = {};
    }
    Polito.EnterViewportBehavior = {

        //public stuff
        enterViewport: function() {},
        exitViewport: function() {},
        prepareToRender: function() {},
        properties: {
            visible: { 
                type: Boolean,
                value: false
                
            },
            padding: {
                type: Number,
                value: 0
            }
        },
        // end public stuff

        _notifiedOnce: false,
        _enter: function() {
            if (!this._notifiedOnce) {
                this._notifiedOnce = true;
                this.prepareToRender();
            }
            if (!this.visible) {
                this.visible = true;
                this.enterViewport();
            }
        },
        _exit: function() {
            if (this.visible) {
                this.exitViewport();
                this.visible = false;
            }
        },
        attached: function() {
            this._setupListeners();
            this._checkVisibility();
        },
        _setupListeners: function() {
            var polito = this;
            window.addEventListener('scroll', function(e) {
                polito._checkVisibility.apply(polito);
            });
        },
        _checkVisibility: function() {
            var el = this;

            var top = el.offsetTop;
            var left = el.offsetLeft;
            var width = el.offsetWidth;
            var height = el.offsetHeight;

            while (el.offsetParent) {
                el = el.offsetParent;
                top += el.offsetTop;
                left += el.offsetLeft;
            }

            var visible = (
                top < (window.pageYOffset + window.innerHeight + this.padding) &&
                left < (window.pageXOffset + window.innerWidth + this.padding) &&
                (top + height) > (window.pageYOffset - this.padding) &&
                (left + width) > (window.pageXOffset - this.padding)
            );
            if (visible) {
                this._enter();
            }
            else {
                this._exit();
            }

        }
    }
</script>
